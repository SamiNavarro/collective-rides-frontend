"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RideEntity = void 0;
const ride_1 = require("../../../../shared/types/ride");
const id_generator_1 = require("../../../../shared/utils/id-generator");
class RideEntity {
    constructor(ride) {
        this.ride = ride;
    }
    static create(request, createdBy, clubId) {
        const now = new Date().toISOString();
        const rideId = (0, id_generator_1.generateId)('ride');
        // Determine initial status based on user permissions
        const initialStatus = request.publishImmediately ? ride_1.RideStatus.PUBLISHED : ride_1.RideStatus.DRAFT;
        const initialAudience = initialStatus === ride_1.RideStatus.PUBLISHED
            ? ride_1.RideAudience.MEMBERS_ONLY
            : ride_1.RideAudience.INVITE_ONLY;
        const ride = {
            rideId,
            clubId,
            title: request.title,
            description: request.description,
            rideType: request.rideType,
            difficulty: request.difficulty,
            status: initialStatus,
            scope: ride_1.RideScope.CLUB,
            audience: initialAudience,
            startDateTime: request.startDateTime,
            estimatedDuration: request.estimatedDuration,
            maxParticipants: request.maxParticipants,
            currentParticipants: 1,
            waitlistCount: 0,
            createdBy,
            createdAt: now,
            updatedAt: now,
            publishedBy: request.publishImmediately ? createdBy : undefined,
            publishedAt: request.publishImmediately ? now : undefined,
            meetingPoint: request.meetingPoint,
            route: request.route,
            requirements: request.requirements,
            isPublic: request.isPublic || false,
            allowWaitlist: request.allowWaitlist || true
        };
        return new RideEntity(ride);
    }
    // Getters
    get rideId() { return this.ride.rideId; }
    get clubId() { return this.ride.clubId; }
    get title() { return this.ride.title; }
    get status() { return this.ride.status; }
    get scope() { return this.ride.scope; }
    get audience() { return this.ride.audience; }
    get createdBy() { return this.ride.createdBy; }
    get startDateTime() { return this.ride.startDateTime; }
    get currentParticipants() { return this.ride.currentParticipants; }
    get maxParticipants() { return this.ride.maxParticipants; }
    toJSON() {
        return { ...this.ride };
    }
    // Business methods
    canBePublished() {
        return this.ride.status === ride_1.RideStatus.DRAFT;
    }
    canBeUpdated() {
        return this.ride.status === ride_1.RideStatus.DRAFT || this.ride.status === ride_1.RideStatus.PUBLISHED;
    }
    canBeCancelled() {
        return this.ride.status === ride_1.RideStatus.DRAFT ||
            this.ride.status === ride_1.RideStatus.PUBLISHED ||
            this.ride.status === ride_1.RideStatus.ACTIVE;
    }
    canAcceptParticipants() {
        if (this.ride.status !== ride_1.RideStatus.PUBLISHED)
            return false;
        if (!this.ride.maxParticipants)
            return true;
        return this.ride.currentParticipants < this.ride.maxParticipants;
    }
    isWaitlistAvailable() {
        return this.ride.allowWaitlist &&
            this.ride.maxParticipants !== undefined &&
            this.ride.currentParticipants >= this.ride.maxParticipants;
    }
    publish(publishedBy, audience, isPublic) {
        if (!this.canBePublished()) {
            throw new Error('Ride cannot be published in current status');
        }
        const now = new Date().toISOString();
        this.ride.status = ride_1.RideStatus.PUBLISHED;
        this.ride.audience = audience || ride_1.RideAudience.MEMBERS_ONLY;
        this.ride.publishedBy = publishedBy;
        this.ride.publishedAt = now;
        this.ride.updatedAt = now;
        if (isPublic !== undefined) {
            this.ride.isPublic = isPublic;
        }
    }
    update(request) {
        if (!this.canBeUpdated()) {
            throw new Error('Ride cannot be updated in current status');
        }
        const now = new Date().toISOString();
        if (request.title !== undefined)
            this.ride.title = request.title;
        if (request.description !== undefined)
            this.ride.description = request.description;
        if (request.startDateTime !== undefined)
            this.ride.startDateTime = request.startDateTime;
        if (request.estimatedDuration !== undefined)
            this.ride.estimatedDuration = request.estimatedDuration;
        if (request.maxParticipants !== undefined)
            this.ride.maxParticipants = request.maxParticipants;
        if (request.meetingPoint !== undefined)
            this.ride.meetingPoint = request.meetingPoint;
        if (request.route !== undefined)
            this.ride.route = request.route;
        if (request.requirements !== undefined)
            this.ride.requirements = request.requirements;
        if (request.isPublic !== undefined)
            this.ride.isPublic = request.isPublic;
        if (request.allowWaitlist !== undefined)
            this.ride.allowWaitlist = request.allowWaitlist;
        this.ride.updatedAt = now;
    }
    cancel(reason) {
        if (!this.canBeCancelled()) {
            throw new Error('Ride cannot be cancelled in current status');
        }
        this.ride.status = ride_1.RideStatus.CANCELLED;
        this.ride.updatedAt = new Date().toISOString();
    }
    activate() {
        if (this.ride.status !== ride_1.RideStatus.PUBLISHED) {
            throw new Error('Only published rides can be activated');
        }
        this.ride.status = ride_1.RideStatus.ACTIVE;
        this.ride.updatedAt = new Date().toISOString();
    }
    complete(completedBy, completionNotes) {
        if (this.ride.status !== ride_1.RideStatus.ACTIVE) {
            throw new Error('Only active rides can be completed');
        }
        const now = new Date().toISOString();
        this.ride.status = ride_1.RideStatus.COMPLETED;
        this.ride.completedAt = now;
        this.ride.completedBy = completedBy;
        this.ride.completionNotes = completionNotes;
        this.ride.updatedAt = now;
    }
    start(startedBy) {
        if (this.ride.status !== ride_1.RideStatus.PUBLISHED) {
            throw new Error('Only published rides can be started');
        }
        const now = new Date().toISOString();
        this.ride.status = ride_1.RideStatus.ACTIVE;
        this.ride.startedAt = now;
        this.ride.startedBy = startedBy;
        this.ride.updatedAt = now;
    }
    canBeCompleted() {
        return this.ride.status === ride_1.RideStatus.ACTIVE;
    }
    canBeStarted() {
        return this.ride.status === ride_1.RideStatus.PUBLISHED;
    }
    incrementParticipants() {
        this.ride.currentParticipants++;
        this.ride.updatedAt = new Date().toISOString();
    }
    decrementParticipants() {
        if (this.ride.currentParticipants > 0) {
            this.ride.currentParticipants--;
            this.ride.updatedAt = new Date().toISOString();
        }
    }
    incrementWaitlist() {
        this.ride.waitlistCount = (this.ride.waitlistCount || 0) + 1;
        this.ride.updatedAt = new Date().toISOString();
    }
    decrementWaitlist() {
        if (this.ride.waitlistCount && this.ride.waitlistCount > 0) {
            this.ride.waitlistCount--;
            this.ride.updatedAt = new Date().toISOString();
        }
    }
}
exports.RideEntity = RideEntity;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmlkZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInJpZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsd0RBT3VDO0FBQ3ZDLHdFQUFtRTtBQUVuRSxNQUFhLFVBQVU7SUFDckIsWUFBb0IsSUFBVTtRQUFWLFNBQUksR0FBSixJQUFJLENBQU07SUFBRyxDQUFDO0lBRWxDLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBMEIsRUFBRSxTQUFpQixFQUFFLE1BQWM7UUFDekUsTUFBTSxHQUFHLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNyQyxNQUFNLE1BQU0sR0FBRyxJQUFBLHlCQUFVLEVBQUMsTUFBTSxDQUFDLENBQUM7UUFFbEMscURBQXFEO1FBQ3JELE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsaUJBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLGlCQUFVLENBQUMsS0FBSyxDQUFDO1FBQzNGLE1BQU0sZUFBZSxHQUFHLGFBQWEsS0FBSyxpQkFBVSxDQUFDLFNBQVM7WUFDNUQsQ0FBQyxDQUFDLG1CQUFZLENBQUMsWUFBWTtZQUMzQixDQUFDLENBQUMsbUJBQVksQ0FBQyxXQUFXLENBQUM7UUFFN0IsTUFBTSxJQUFJLEdBQVM7WUFDakIsTUFBTTtZQUNOLE1BQU07WUFDTixLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUs7WUFDcEIsV0FBVyxFQUFFLE9BQU8sQ0FBQyxXQUFXO1lBQ2hDLFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUTtZQUMxQixVQUFVLEVBQUUsT0FBTyxDQUFDLFVBQVU7WUFDOUIsTUFBTSxFQUFFLGFBQWE7WUFDckIsS0FBSyxFQUFFLGdCQUFTLENBQUMsSUFBSTtZQUNyQixRQUFRLEVBQUUsZUFBZTtZQUN6QixhQUFhLEVBQUUsT0FBTyxDQUFDLGFBQWE7WUFDcEMsaUJBQWlCLEVBQUUsT0FBTyxDQUFDLGlCQUFpQjtZQUM1QyxlQUFlLEVB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QUNuQixJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsQ0FBQyxFQUFFO1lBQ3JDLElBQUksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztZQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQ2hEO0lBQ0gsQ0FBQztJQUVELGlCQUFpQjtRQUNmLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdELElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDakQsQ0FBQztJQUVELGlCQUFpQjtRQUNmLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxFQUFFO1lBQzFELElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUNoRDtJQUNILENBQUM7Q0FDRjtBQXRNRCxnQ0FzTUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBcbiAgUmlkZSwgXG4gIFJpZGVTdGF0dXMsIFxuICBSaWRlU2NvcGUsIFxuICBSaWRlQXVkaWVuY2UsIFxuICBDcmVhdGVSaWRlUmVxdWVzdCxcbiAgVXBkYXRlUmlkZVJlcXVlc3QgXG59IGZyb20gJy4uLy4uLy4uLy4uL3NoYXJlZC90eXBlcy9yaWRlJztcbmltcG9ydCB7IGdlbmVyYXRlSWQgfSBmcm9tICcuLi8uLi8uLi8uLi9zaGFyZWQvdXRpbHMvaWQtZ2VuZXJhdG9yJztcblxuZXhwb3J0IGNsYXNzIFJpZGVFbnRpdHkge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJpZGU6IFJpZGUpIHt9XG5cbiAgc3RhdGljIGNyZWF0ZShyZXF1ZXN0OiBDcmVhdGVSaWRlUmVxdWVzdCwgY3JlYXRlZEJ5OiBzdHJpbmcsIGNsdWJJZDogc3RyaW5nKTogUmlkZUVudGl0eSB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IHJpZGVJZCA9IGdlbmVyYXRlSWQoJ3JpZGUnKTtcbiAgICBcbiAgICAvLyBEZXRlcm1pbmUgaW5pdGlhbCBzdGF0dXMgYmFzZWQgb24gdXNlciBwZXJtaXNzaW9uc1xuICAgIGNvbnN0IGluaXRpYWxTdGF0dXMgPSByZXF1ZXN0LnB1Ymxpc2hJbW1lZGlhdGVseSA/IFJpZGVTdGF0dXMuUFVCTElTSEVEIDogUmlkZVN0YXR1cy5EUkFGVDtcbiAgICBjb25zdCBpbml0aWFsQXVkaWVuY2UgPSBpbml0aWFsU3RhdHVzID09PSBSaWRlU3RhdHVzLlBVQkxJU0hFRCBcbiAgICAgID8gUmlkZUF1ZGllbmNlLk1FTUJFUlNfT05MWSBcbiAgICAgIDogUmlkZUF1ZGllbmNlLklOVklURV9PTkxZO1xuXG4gICAgY29uc3QgcmlkZTogUmlkZSA9IHtcbiAgICAgIHJpZGVJZCxcbiAgICAgIGNsdWJJZCxcbiAgICAgIHRpdGxlOiByZXF1ZXN0LnRpdGxlLFxuICAgICAgZGVzY3JpcHRpb246IHJlcXVlc3QuZGVzY3JpcHRpb24sXG4gICAgICByaWRlVHlwZTogcmVxdWVzdC5yaWRlVHlwZSxcbiAgICAgIGRpZmZpY3VsdHk6IHJlcXVlc3QuZGlmZmljdWx0eSxcbiAgICAgIHN0YXR1czogaW5pdGlhbFN0YXR1cyxcbiAgICAgIHNjb3BlOiBSaWRlU2NvcGUuQ0xVQiwgLy8gUGhhc2UgMi4zIG9ubHkgc3VwcG9ydHMgY2x1YiByaWRlc1xuICAgICAgYXVkaWVuY2U6IGluaXRpYWxBdWRpZW5jZSxcbiAgICAgIHN0YXJ0RGF0ZVRpbWU6IHJlcXVlc3Quc3RhcnREYXRlVGltZSxcbiAgICAgIGVzdGltYXRlZER1cmF0aW9uOiByZXF1ZXN0LmVzdGltYXRlZER1cmF0aW9uLFxuICAgICAgbWF4UGFydGljaXBhbnRzOiByZXF1ZXN0Lm1heFBhcnRpY2lwYW50cyxcbiAgICAgIGN1cnJlbnRQYXJ0aWNpcGFudHM6IDEsIC8vIENyZWF0b3IgaXMgYXV0b21hdGljYWxseSBhIHBhcnRpY2lwYW50XG4gICAgICB3YWl0bGlzdENvdW50OiAwLFxuICAgICAgY3JlYXRlZEJ5LFxuICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIHB1Ymxpc2hlZEJ5OiByZXF1ZXN0LnB1Ymxpc2hJbW1lZGlhdGVseSA/IGNyZWF0ZWRCeSA6IHVuZGVmaW5lZCxcbiAgICAgIHB1Ymxpc2hlZEF0OiByZXF1ZXN0LnB1Ymxpc2hJbW1lZGlhdGVseSA/IG5vdyA6IHVuZGVmaW5lZCxcbiAgICAgIG1lZXRpbmdQb2ludDogcmVxdWVzdC5tZWV0aW5nUG9pbnQsXG4gICAgICByb3V0ZTogcmVxdWVzdC5yb3V0ZSxcbiAgICAgIHJlcXVpcmVtZW50czogcmVxdWVzdC5yZXF1aXJlbWVudHMsXG4gICAgICBpc1B1YmxpYzogcmVxdWVzdC5pc1B1YmxpYyB8fCBmYWxzZSxcbiAgICAgIGFsbG93V2FpdGxpc3Q6IHJlcXVlc3QuYWxsb3dXYWl0bGlzdCB8fCB0cnVlXG4gICAgfTtcblxuICAgIHJldHVybiBuZXcgUmlkZUVudGl0eShyaWRlKTtcbiAgfVxuXG4gIC8vIEdldHRlcnNcbiAgZ2V0IHJpZGVJZCgpOiBzdHJpbmcgeyByZXR1cm4gdGhpcy5yaWRlLnJpZGVJZDsgfVxuICBnZXQgY2x1YklkKCk6IHN0cmluZyB7IHJldHVybiB0aGlzLnJpZGUuY2x1YklkOyB9XG4gIGdldCB0aXRsZSgpOiBzdHJpbmcgeyByZXR1cm4gdGhpcy5yaWRlLnRpdGxlOyB9XG4gIGdldCBzdGF0dXMoKTogUmlkZVN0YXR1cyB7IHJldHVybiB0aGlzLnJpZGUuc3RhdHVzOyB9XG4gIGdldCBzY29wZSgpOiBSaWRlU2NvcGUgeyByZXR1cm4gdGhpcy5yaWRlLnNjb3BlOyB9XG4gIGdldCBhdWRpZW5jZSgpOiBSaWRlQXVkaWVuY2UgeyByZXR1cm4gdGhpcy5yaWRlLmF1ZGllbmNlOyB9XG4gIGdldCBjcmVhdGVkQnkoKTogc3RyaW5nIHsgcmV0dXJuIHRoaXMucmlkZS5jcmVhdGVkQnk7IH1cbiAgZ2V0IHN0YXJ0RGF0ZVRpbWUoKTogc3RyaW5nIHsgcmV0dXJuIHRoaXMucmlkZS5zdGFydERhdGVUaW1lOyB9XG4gIGdldCBjdXJyZW50UGFydGljaXBhbnRzKCk6IG51bWJlciB7IHJldHVybiB0aGlzLnJpZGUuY3VycmVudFBhcnRpY2lwYW50czsgfVxuICBnZXQgbWF4UGFydGljaXBhbnRzKCk6IG51bWJlciB8IHVuZGVmaW5lZCB7IHJldHVybiB0aGlzLnJpZGUubWF4UGFydGljaXBhbnRzOyB9XG5cbiAgdG9KU09OKCk6IFJpZGUge1xuICAgIHJldHVybiB7IC4uLnRoaXMucmlkZSB9O1xuICB9XG5cbiAgLy8gQnVzaW5lc3MgbWV0aG9kc1xuICBjYW5CZVB1Ymxpc2hlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5yaWRlLnN0YXR1cyA9PT0gUmlkZVN0YXR1cy5EUkFGVDtcbiAgfVxuXG4gIGNhbkJlVXBkYXRlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5yaWRlLnN0YXR1cyA9PT0gUmlkZVN0YXR1cy5EUkFGVCB8fCB0aGlzLnJpZGUuc3RhdHVzID09PSBSaWRlU3RhdHVzLlBVQkxJU0hFRDtcbiAgfVxuXG4gIGNhbkJlQ2FuY2VsbGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnJpZGUuc3RhdHVzID09PSBSaWRlU3RhdHVzLkRSQUZUIHx8IFxuICAgICAgICAgICB0aGlzLnJpZGUuc3RhdHVzID09PSBSaWRlU3RhdHVzLlBVQkxJU0hFRCB8fCBcbiAgICAgICAgICAgdGhpcy5yaWRlLnN0YXR1cyA9PT0gUmlkZVN0YXR1cy5BQ1RJVkU7XG4gIH1cblxuICBjYW5BY2NlcHRQYXJ0aWNpcGFudHMoKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMucmlkZS5zdGF0dXMgIT09IFJpZGVTdGF0dXMuUFVCTElTSEVEKSByZXR1cm4gZmFsc2U7XG4gICAgaWYgKCF0aGlzLnJpZGUubWF4UGFydGljaXBhbnRzKSByZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gdGhpcy5yaWRlLmN1cnJlbnRQYXJ0aWNpcGFudHMgPCB0aGlzLnJpZGUubWF4UGFydGljaXBhbnRzO1xuICB9XG5cbiAgaXNXYWl0bGlzdEF2YWlsYWJsZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5yaWRlLmFsbG93V2FpdGxpc3QgJiYgXG4gICAgICAgICAgIHRoaXMucmlkZS5tYXhQYXJ0aWNpcGFudHMgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICB0aGlzLnJpZGUuY3VycmVudFBhcnRpY2lwYW50cyA+PSB0aGlzLnJpZGUubWF4UGFydGljaXBhbnRzO1xuICB9XG5cbiAgcHVibGlzaChwdWJsaXNoZWRCeTogc3RyaW5nLCBhdWRpZW5jZT86IFJpZGVBdWRpZW5jZSwgaXNQdWJsaWM/OiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNhbkJlUHVibGlzaGVkKCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmlkZSBjYW5ub3QgYmUgcHVibGlzaGVkIGluIGN1cnJlbnQgc3RhdHVzJyk7XG4gICAgfVxuXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIHRoaXMucmlkZS5zdGF0dXMgPSBSaWRlU3RhdHVzLlBVQkxJU0hFRDtcbiAgICB0aGlzLnJpZGUuYXVkaWVuY2UgPSBhdWRpZW5jZSB8fCBSaWRlQXVkaWVuY2UuTUVNQkVSU19PTkxZO1xuICAgIHRoaXMucmlkZS5wdWJsaXNoZWRCeSA9IHB1Ymxpc2hlZEJ5O1xuICAgIHRoaXMucmlkZS5wdWJsaXNoZWRBdCA9IG5vdztcbiAgICB0aGlzLnJpZGUudXBkYXRlZEF0ID0gbm93O1xuICAgIFxuICAgIGlmIChpc1B1YmxpYyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLnJpZGUuaXNQdWJsaWMgPSBpc1B1YmxpYztcbiAgICB9XG4gIH1cblxuICB1cGRhdGUocmVxdWVzdDogVXBkYXRlUmlkZVJlcXVlc3QpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuY2FuQmVVcGRhdGVkKCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmlkZSBjYW5ub3QgYmUgdXBkYXRlZCBpbiBjdXJyZW50IHN0YXR1cycpO1xuICAgIH1cblxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBcbiAgICBpZiAocmVxdWVzdC50aXRsZSAhPT0gdW5kZWZpbmVkKSB0aGlzLnJpZGUudGl0bGUgPSByZXF1ZXN0LnRpdGxlO1xuICAgIGlmIChyZXF1ZXN0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHRoaXMucmlkZS5kZXNjcmlwdGlvbiA9IHJlcXVlc3QuZGVzY3JpcHRpb247XG4gICAgaWYgKHJlcXVlc3Quc3RhcnREYXRlVGltZSAhPT0gdW5kZWZpbmVkKSB0aGlzLnJpZGUuc3RhcnREYXRlVGltZSA9IHJlcXVlc3Quc3RhcnREYXRlVGltZTtcbiAgICBpZiAocmVxdWVzdC5lc3RpbWF0ZWREdXJhdGlvbiAhPT0gdW5kZWZpbmVkKSB0aGlzLnJpZGUuZXN0aW1hdGVkRHVyYXRpb24gPSByZXF1ZXN0LmVzdGltYXRlZER1cmF0aW9uO1xuICAgIGlmIChyZXF1ZXN0Lm1heFBhcnRpY2lwYW50cyAhPT0gdW5kZWZpbmVkKSB0aGlzLnJpZGUubWF4UGFydGljaXBhbnRzID0gcmVxdWVzdC5tYXhQYXJ0aWNpcGFudHM7XG4gICAgaWYgKHJlcXVlc3QubWVldGluZ1BvaW50ICE9PSB1bmRlZmluZWQpIHRoaXMucmlkZS5tZWV0aW5nUG9pbnQgPSByZXF1ZXN0Lm1lZXRpbmdQb2ludDtcbiAgICBpZiAocmVxdWVzdC5yb3V0ZSAhPT0gdW5kZWZpbmVkKSB0aGlzLnJpZGUucm91dGUgPSByZXF1ZXN0LnJvdXRlO1xuICAgIGlmIChyZXF1ZXN0LnJlcXVpcmVtZW50cyAhPT0gdW5kZWZpbmVkKSB0aGlzLnJpZGUucmVxdWlyZW1lbnRzID0gcmVxdWVzdC5yZXF1aXJlbWVudHM7XG4gICAgaWYgKHJlcXVlc3QuaXNQdWJsaWMgIT09IHVuZGVmaW5lZCkgdGhpcy5yaWRlLmlzUHVibGljID0gcmVxdWVzdC5pc1B1YmxpYztcbiAgICBpZiAocmVxdWVzdC5hbGxvd1dhaXRsaXN0ICE9PSB1bmRlZmluZWQpIHRoaXMucmlkZS5hbGxvd1dhaXRsaXN0ID0gcmVxdWVzdC5hbGxvd1dhaXRsaXN0O1xuICAgIFxuICAgIHRoaXMucmlkZS51cGRhdGVkQXQgPSBub3c7XG4gIH1cblxuICBjYW5jZWwocmVhc29uPzogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNhbkJlQ2FuY2VsbGVkKCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmlkZSBjYW5ub3QgYmUgY2FuY2VsbGVkIGluIGN1cnJlbnQgc3RhdHVzJyk7XG4gICAgfVxuXG4gICAgdGhpcy5yaWRlLnN0YXR1cyA9IFJpZGVTdGF0dXMuQ0FOQ0VMTEVEO1xuICAgIHRoaXMucmlkZS51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gIH1cblxuICBhY3RpdmF0ZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5yaWRlLnN0YXR1cyAhPT0gUmlkZVN0YXR1cy5QVUJMSVNIRUQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignT25seSBwdWJsaXNoZWQgcmlkZXMgY2FuIGJlIGFjdGl2YXRlZCcpO1xuICAgIH1cblxuICAgIHRoaXMucmlkZS5zdGF0dXMgPSBSaWRlU3RhdHVzLkFDVElWRTtcbiAgICB0aGlzLnJpZGUudXBkYXRlZEF0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICB9XG5cbiAgY29tcGxldGUoY29tcGxldGVkQnk6IHN0cmluZywgY29tcGxldGlvbk5vdGVzPzogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKHRoaXMucmlkZS5zdGF0dXMgIT09IFJpZGVTdGF0dXMuQUNUSVZFKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ09ubHkgYWN0aXZlIHJpZGVzIGNhbiBiZSBjb21wbGV0ZWQnKTtcbiAgICB9XG5cbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgdGhpcy5yaWRlLnN0YXR1cyA9IFJpZGVTdGF0dXMuQ09NUExFVEVEO1xuICAgIHRoaXMucmlkZS5jb21wbGV0ZWRBdCA9IG5vdztcbiAgICB0aGlzLnJpZGUuY29tcGxldGVkQnkgPSBjb21wbGV0ZWRCeTtcbiAgICB0aGlzLnJpZGUuY29tcGxldGlvbk5vdGVzID0gY29tcGxldGlvbk5vdGVzO1xuICAgIHRoaXMucmlkZS51cGRhdGVkQXQgPSBub3c7XG4gIH1cblxuICBzdGFydChzdGFydGVkQnk6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICh0aGlzLnJpZGUuc3RhdHVzICE9PSBSaWRlU3RhdHVzLlBVQkxJU0hFRCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdPbmx5IHB1Ymxpc2hlZCByaWRlcyBjYW4gYmUgc3RhcnRlZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICB0aGlzLnJpZGUuc3RhdHVzID0gUmlkZVN0YXR1cy5BQ1RJVkU7XG4gICAgdGhpcy5yaWRlLnN0YXJ0ZWRBdCA9IG5vdztcbiAgICB0aGlzLnJpZGUuc3RhcnRlZEJ5ID0gc3RhcnRlZEJ5O1xuICAgIHRoaXMucmlkZS51cGRhdGVkQXQgPSBub3c7XG4gIH1cblxuICBjYW5CZUNvbXBsZXRlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5yaWRlLnN0YXR1cyA9PT0gUmlkZVN0YXR1cy5BQ1RJVkU7XG4gIH1cblxuICBjYW5CZVN0YXJ0ZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMucmlkZS5zdGF0dXMgPT09IFJpZGVTdGF0dXMuUFVCTElTSEVEO1xuICB9XG5cbiAgaW5jcmVtZW50UGFydGljaXBhbnRzKCk6IHZvaWQge1xuICAgIHRoaXMucmlkZS5jdXJyZW50UGFydGljaXBhbnRzKys7XG4gICAgdGhpcy5yaWRlLnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgfVxuXG4gIGRlY3JlbWVudFBhcnRpY2lwYW50cygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5yaWRlLmN1cnJlbnRQYXJ0aWNpcGFudHMgPiAwKSB7XG4gICAgICB0aGlzLnJpZGUuY3VycmVudFBhcnRpY2lwYW50cy0tO1xuICAgICAgdGhpcy5yaWRlLnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICB9XG4gIH1cblxuICBpbmNyZW1lbnRXYWl0bGlzdCgpOiB2b2lkIHtcbiAgICB0aGlzLnJpZGUud2FpdGxpc3RDb3VudCA9ICh0aGlzLnJpZGUud2FpdGxpc3RDb3VudCB8fCAwKSArIDE7XG4gICAgdGhpcy5yaWRlLnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgfVxuXG4gIGRlY3JlbWVudFdhaXRsaXN0KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnJpZGUud2FpdGxpc3RDb3VudCAmJiB0aGlzLnJpZGUud2FpdGxpc3RDb3VudCA+IDApIHtcbiAgICAgIHRoaXMucmlkZS53YWl0bGlzdENvdW50LS07XG4gICAgICB0aGlzLnJpZGUudXBkYXRlZEF0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIH1cbiAgfVxufSJdfQ==