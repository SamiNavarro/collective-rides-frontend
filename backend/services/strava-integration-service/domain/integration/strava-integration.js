"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.StravaIntegrationEntity = void 0;
class StravaIntegrationEntity {
    constructor(integration) {
        this.integration = integration;
    }
    static create(userId, athleteId, scopesGranted, accessTokenRef, refreshTokenRef, expiresAt) {
        const now = new Date().toISOString();
        const tokenExpiresAt = new Date(expiresAt * 1000).toISOString();
        const integration = {
            userId,
            provider: 'strava',
            athleteId,
            scopesGranted,
            accessTokenRef,
            refreshTokenRef,
            tokenExpiresAt,
            connectedAt: now
        };
        return new StravaIntegrationEntity(integration);
    }
    // Getters
    get userId() { return this.integration.userId; }
    get athleteId() { return this.integration.athleteId; }
    get accessTokenRef() { return this.integration.accessTokenRef; }
    get refreshTokenRef() { return this.integration.refreshTokenRef; }
    get tokenExpiresAt() { return this.integration.tokenExpiresAt; }
    get isRevoked() { return this.integration.revokedAt !== undefined; }
    toJSON() {
        return { ...this.integration };
    }
    // Business methods
    isTokenExpired() {
        return new Date() >= new Date(this.integration.tokenExpiresAt);
    }
    updateTokens(accessTokenRef, refreshTokenRef, expiresAt) {
        this.integration.accessTokenRef = accessTokenRef;
        this.integration.refreshTokenRef = refreshTokenRef;
        this.integration.tokenExpiresAt = new Date(expiresAt * 1000).toISOString();
        this.integration.lastSyncAt = new Date().toISOString();
    }
    revoke() {
        this.integration.revokedAt = new Date().toISOString();
    }
    updateLastSync() {
        this.integration.lastSyncAt = new Date().toISOString();
    }
    hasScope(scope) {
        return this.integration.scopesGranted.includes(scope);
    }
    canReadActivities() {
        return this.hasScope('read') || this.hasScope('read_all');
    }
}
exports.StravaIntegrationEntity = StravaIntegrationEntity;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RyYXZhLWludGVncmF0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3RyYXZhLWludGVncmF0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUdBLE1BQWEsdUJBQXVCO0lBQ2xDLFlBQW9CLFdBQThCO1FBQTlCLGdCQUFXLEdBQVgsV0FBVyxDQUFtQjtJQUFHLENBQUM7SUFFdEQsTUFBTSxDQUFDLE1BQU0sQ0FDWCxNQUFjLEVBQ2QsU0FBaUIsRUFDakIsYUFBdUIsRUFDdkIsY0FBc0IsRUFDdEIsZUFBdUIsRUFDdkIsU0FBaUI7UUFFakIsTUFBTSxHQUFHLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNyQyxNQUFNLGNBQWMsR0FBRyxJQUFJLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFaEUsTUFBTSxXQUFXLEdBQXNCO1lBQ3JDLE1BQU07WUFDTixRQUFRLEVBQUUsUUFBUTtZQUNsQixTQUFTO1lBQ1QsYUFBYTtZQUNiLGNBQWM7WUFDZCxlQUFlO1lBQ2YsY0FBYztZQUNkLFdBQVcsRUFBRSxHQUFHO1NBQ2pCLENBQUM7UUFFRixPQUFPLElBQUksdUJBQXVCLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUVELFVBQVU7SUFDVixJQUFJLE1BQU0sS0FBYSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUN4RCxJQUFJLFNBQVMsS0FBYSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUM5RCxJQUFJLGNBQWMsS0FBYSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztJQUN4RSxJQUFJLGVBQWUsS0FBYSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztJQUMxRSxJQUFJLGNBQWMsS0FBYSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztJQUN4RSxJQUFJLFNBQVMsS0FBYyxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7SUFFN0UsTUFBTTtRQUNKLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNqQyxDQUFDO0lBRUQsbUJBQW1CO0lBQ25CLGNBQWM7UUFDWixPQUFPLElBQUksSUFBSSxFQUFFLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUNqRSxDQUFDO0lBRUQsWUFBWSxDQUFDLGNBQXNCLEVBQUUsZUFBdUIsRUFBRSxTQUFpQjtRQUM3RSxJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsR0FBRyxjQUFjLENBQUM7UUFDakQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxlQUFlLEdBQUcsZUFBZSxDQUFDO1FBQ25ELElBQUksQ0FBQyxXQUFXLENBQUMsY0FBYyxHQUFHLElBQUksSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMzRSxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3pELENBQUM7SUFFRCxNQUFNO1FBQ0osSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUN4RCxDQUFDO0lBRUQsY0FBYztRQUNaLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDekQsQ0FBQztJQUVELFFBQVEsQ0FBQyxLQUFhO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFFRCxpQkFBaUI7UUFDZixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM1RCxDQUFDO0NBQ0Y7QUFuRUQsMERBbUVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3RyYXZhSW50ZWdyYXRpb24gfSBmcm9tICcuLi8uLi8uLi8uLi9zaGFyZWQvdHlwZXMvc3RyYXZhJztcbmltcG9ydCB7IGdlbmVyYXRlSWQgfSBmcm9tICcuLi8uLi8uLi8uLi9zaGFyZWQvdXRpbHMvaWQtZ2VuZXJhdG9yJztcblxuZXhwb3J0IGNsYXNzIFN0cmF2YUludGVncmF0aW9uRW50aXR5IHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBpbnRlZ3JhdGlvbjogU3RyYXZhSW50ZWdyYXRpb24pIHt9XG5cbiAgc3RhdGljIGNyZWF0ZShcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBhdGhsZXRlSWQ6IHN0cmluZyxcbiAgICBzY29wZXNHcmFudGVkOiBzdHJpbmdbXSxcbiAgICBhY2Nlc3NUb2tlblJlZjogc3RyaW5nLFxuICAgIHJlZnJlc2hUb2tlblJlZjogc3RyaW5nLFxuICAgIGV4cGlyZXNBdDogbnVtYmVyXG4gICk6IFN0cmF2YUludGVncmF0aW9uRW50aXR5IHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgY29uc3QgdG9rZW5FeHBpcmVzQXQgPSBuZXcgRGF0ZShleHBpcmVzQXQgKiAxMDAwKS50b0lTT1N0cmluZygpO1xuXG4gICAgY29uc3QgaW50ZWdyYXRpb246IFN0cmF2YUludGVncmF0aW9uID0ge1xuICAgICAgdXNlcklkLFxuICAgICAgcHJvdmlkZXI6ICdzdHJhdmEnLFxuICAgICAgYXRobGV0ZUlkLFxuICAgICAgc2NvcGVzR3JhbnRlZCxcbiAgICAgIGFjY2Vzc1Rva2VuUmVmLFxuICAgICAgcmVmcmVzaFRva2VuUmVmLFxuICAgICAgdG9rZW5FeHBpcmVzQXQsXG4gICAgICBjb25uZWN0ZWRBdDogbm93XG4gICAgfTtcblxuICAgIHJldHVybiBuZXcgU3RyYXZhSW50ZWdyYXRpb25FbnRpdHkoaW50ZWdyYXRpb24pO1xuICB9XG5cbiAgLy8gR2V0dGVyc1xuICBnZXQgdXNlcklkKCk6IHN0cmluZyB7IHJldHVybiB0aGlzLmludGVncmF0aW9uLnVzZXJJZDsgfVxuICBnZXQgYXRobGV0ZUlkKCk6IHN0cmluZyB7IHJldHVybiB0aGlzLmludGVncmF0aW9uLmF0aGxldGVJZDsgfVxuICBnZXQgYWNjZXNzVG9rZW5SZWYoKTogc3RyaW5nIHsgcmV0dXJuIHRoaXMuaW50ZWdyYXRpb24uYWNjZXNzVG9rZW5SZWY7IH1cbiAgZ2V0IHJlZnJlc2hUb2tlblJlZigpOiBzdHJpbmcgeyByZXR1cm4gdGhpcy5pbnRlZ3JhdGlvbi5yZWZyZXNoVG9rZW5SZWY7IH1cbiAgZ2V0IHRva2VuRXhwaXJlc0F0KCk6IHN0cmluZyB7IHJldHVybiB0aGlzLmludGVncmF0aW9uLnRva2VuRXhwaXJlc0F0OyB9XG4gIGdldCBpc1Jldm9rZWQoKTogYm9vbGVhbiB7IHJldHVybiB0aGlzLmludGVncmF0aW9uLnJldm9rZWRBdCAhPT0gdW5kZWZpbmVkOyB9XG5cbiAgdG9KU09OKCk6IFN0cmF2YUludGVncmF0aW9uIHtcbiAgICByZXR1cm4geyAuLi50aGlzLmludGVncmF0aW9uIH07XG4gIH1cblxuICAvLyBCdXNpbmVzcyBtZXRob2RzXG4gIGlzVG9rZW5FeHBpcmVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBuZXcgRGF0ZSgpID49IG5ldyBEYXRlKHRoaXMuaW50ZWdyYXRpb24udG9rZW5FeHBpcmVzQXQpO1xuICB9XG5cbiAgdXBkYXRlVG9rZW5zKGFjY2Vzc1Rva2VuUmVmOiBzdHJpbmcsIHJlZnJlc2hUb2tlblJlZjogc3RyaW5nLCBleHBpcmVzQXQ6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuaW50ZWdyYXRpb24uYWNjZXNzVG9rZW5SZWYgPSBhY2Nlc3NUb2tlblJlZjtcbiAgICB0aGlzLmludGVncmF0aW9uLnJlZnJlc2hUb2tlblJlZiA9IHJlZnJlc2hUb2tlblJlZjtcbiAgICB0aGlzLmludGVncmF0aW9uLnRva2VuRXhwaXJlc0F0ID0gbmV3IERhdGUoZXhwaXJlc0F0ICogMTAwMCkudG9JU09TdHJpbmcoKTtcbiAgICB0aGlzLmludGVncmF0aW9uLmxhc3RTeW5jQXQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gIH1cblxuICByZXZva2UoKTogdm9pZCB7XG4gICAgdGhpcy5pbnRlZ3JhdGlvbi5yZXZva2VkQXQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gIH1cblxuICB1cGRhdGVMYXN0U3luYygpOiB2b2lkIHtcbiAgICB0aGlzLmludGVncmF0aW9uLmxhc3RTeW5jQXQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gIH1cblxuICBoYXNTY29wZShzY29wZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaW50ZWdyYXRpb24uc2NvcGVzR3JhbnRlZC5pbmNsdWRlcyhzY29wZSk7XG4gIH1cblxuICBjYW5SZWFkQWN0aXZpdGllcygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5oYXNTY29wZSgncmVhZCcpIHx8IHRoaXMuaGFzU2NvcGUoJ3JlYWRfYWxsJyk7XG4gIH1cbn0iXX0=