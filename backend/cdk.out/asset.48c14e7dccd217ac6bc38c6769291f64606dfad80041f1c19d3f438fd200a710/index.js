"use strict";var s=Object.defineProperty;var i=Object.getOwnPropertyDescriptor;var c=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var d=(e,t)=>{for(var r in t)s(e,r,{get:t[r],enumerable:!0})},l=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of c(t))!y.call(e,o)&&o!==r&&s(e,o,{get:()=>t[o],enumerable:!(a=i(t,o))||a.enumerable});return e};var u=e=>l(s({},"__esModule",{value:!0}),e);var m={};d(m,{handler:()=>b});module.exports=u(m);var b=async e=>{let t=e.httpMethod;return t==="GET"?h(e):t==="POST"?v(e):{statusCode:405,body:JSON.stringify({success:!1,error:"Method not allowed"})}};async function h(e){let t=e.queryStringParameters;if(!t)return{statusCode:400,body:JSON.stringify({success:!1,error:"Missing query parameters"})};let r=t["hub.mode"],a=t["hub.challenge"],o=t["hub.verify_token"],n=process.env.STRAVA_WEBHOOK_VERIFY_TOKEN;return r==="subscribe"&&o===n?(console.log("Strava webhook subscription verified"),{statusCode:200,headers:{"Content-Type":"application/json"},body:JSON.stringify({"hub.challenge":a})}):{statusCode:403,body:JSON.stringify({success:!1,error:"Forbidden"})}}async function v(e){try{if(!f(e))return{statusCode:403,body:JSON.stringify({success:!1,error:"Invalid webhook signature"})};let t=JSON.parse(e.body||"{}");return await g(t),{statusCode:200,body:JSON.stringify({success:!0})}}catch(t){return console.error("Webhook processing error:",t),{statusCode:500,body:JSON.stringify({success:!1,error:"Webhook processing failed"})}}}function f(e){return!0}async function g(e){if(console.log("Processing Strava webhook event:",e),e.object_type!=="activity"){console.log("Ignoring non-activity webhook event");return}switch(e.aspect_type){case"create":await P(e);break;case"update":await p(e);break;case"delete":await S(e);break;default:console.log(`Unhandled aspect type: ${e.aspect_type}`)}}async function P(e){console.log(`Activity created: ${e.object_id} by athlete ${e.owner_id}`)}async function p(e){console.log(`Activity updated: ${e.object_id}`)}async function S(e){console.log(`Activity deleted: ${e.object_id}`)}0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
