<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear Cognito Cache</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßπ Clear Cognito Cache</h1>
        <p>This page helps clear any cached Cognito data that might be causing User Pool ID mismatches.</p>
        
        <div class="info">
            <strong>Current Configuration:</strong><br>
            User Pool ID: <code id="userPoolId">Loading...</code><br>
            Client ID: <code id="clientId">Loading...</code><br>
            Region: <code id="region">Loading...</code>
        </div>

        <h3>üîß Actions</h3>
        <button class="button" onclick="clearLocalStorage()">Clear localStorage</button>
        <button class="button" onclick="clearSessionStorage()">Clear sessionStorage</button>
        <button class="button" onclick="clearAllStorage()">Clear All Storage</button>
        <button class="button" onclick="reloadPage()">Reload Page</button>

        <div id="results"></div>

        <h3>üìã Manual Steps</h3>
        <ol>
            <li><strong>Clear Browser Cache:</strong> Press <code>Ctrl+Shift+R</code> (or <code>Cmd+Shift+R</code> on Mac)</li>
            <li><strong>Open Developer Tools:</strong> Press <code>F12</code></li>
            <li><strong>Clear Application Data:</strong> Go to Application tab ‚Üí Storage ‚Üí Clear site data</li>
            <li><strong>Check Network Tab:</strong> Monitor API calls for correct User Pool ID</li>
        </ol>

        <h3>üîç Troubleshooting</h3>
        <p>If you're still seeing the error <code>us-east-2_taARRQ6vu does not exist</code>:</p>
        <ul>
            <li>The correct User Pool ID is: <strong>us-east-2_t5UUpOmPL</strong></li>
            <li>Clear all browser data and restart the browser</li>
            <li>Check that environment variables are loaded correctly</li>
            <li>Verify the backend is using the correct User Pool</li>
        </ul>

        <div class="code">
            <strong>Console Commands:</strong><br>
            localStorage.clear();<br>
            sessionStorage.clear();<br>
            location.reload(true);
        </div>
    </div>

    <script>
        // Display current configuration
        document.getElementById('userPoolId').textContent = 
            process?.env?.NEXT_PUBLIC_COGNITO_USER_POOL_ID || 'Not available (client-side)';
        document.getElementById('clientId').textContent = 
            process?.env?.NEXT_PUBLIC_COGNITO_CLIENT_ID || 'Not available (client-side)';
        document.getElementById('region').textContent = 
            process?.env?.NEXT_PUBLIC_AWS_REGION || 'Not available (client-side)';

        function showResult(message, type = 'success') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            results.appendChild(div);
            
            // Remove after 3 seconds
            setTimeout(() => {
                div.remove();
            }, 3000);
        }

        function clearLocalStorage() {
            try {
                const itemCount = localStorage.length;
                localStorage.clear();
                showResult(`‚úÖ Cleared ${itemCount} localStorage items`);
            } catch (error) {
                showResult(`‚ùå Error clearing localStorage: ${error.message}`, 'error');
            }
        }

        function clearSessionStorage() {
            try {
                const itemCount = sessionStorage.length;
                sessionStorage.clear();
                showResult(`‚úÖ Cleared ${itemCount} sessionStorage items`);
            } catch (error) {
                showResult(`‚ùå Error clearing sessionStorage: ${error.message}`, 'error');
            }
        }

        function clearAllStorage() {
            clearLocalStorage();
            clearSessionStorage();
            
            // Clear cookies for this domain
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
            });
            
            showResult('‚úÖ Cleared all storage (localStorage, sessionStorage, cookies)');
        }

        function reloadPage() {
            showResult('üîÑ Reloading page...');
            setTimeout(() => {
                location.reload(true);
            }, 1000);
        }

        // Check for stored Cognito tokens
        window.addEventListener('load', () => {
            const tokens = localStorage.getItem('cognito_tokens');
            if (tokens) {
                try {
                    const parsed = JSON.parse(tokens);
                    showResult('‚ö†Ô∏è Found stored Cognito tokens. Consider clearing if experiencing issues.', 'info');
                } catch (e) {
                    showResult('‚ö†Ô∏è Found invalid Cognito tokens in localStorage.', 'info');
                }
            }
        });
    </script>
</body>
</html>